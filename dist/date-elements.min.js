/**
 * Copyright (c) 2015, Leo Di Donato <leodidonato@gmail.com>
 * ng-date-elements.js - AngularJS directives for date elements
 * @version 0.3.0
 * @link http://github.com/leodido/ng-date-elements
 * @license MIT
 */
(function(){function e(a,b,c){return a.call.apply(a.bind,arguments)}function l(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function m(a,b,c){m=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf('native code')?e:l;return m.apply(null,arguments)}
function n(a,b){function c(){}c.prototype=b.prototype;a.u=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.t=function(a,c,g){for(var h=Array(arguments.length-2),k=2;k<arguments.length;k++)h[k-2]=arguments[k];return b.prototype[c].apply(a,h)}};function p(){}
p.prototype.a=function(){return{restrict:'AC',require:'?ngModel',replace:!1,scope:{getOptions:'&options',name:'@'},template:'<div data-select-composite data-options="getOptions()"><div name="{{::options.month.name}}" data-month-select data-empty-option="{{::options.month.emptyOption}}" data-format="{{::options.month.format}}"></div><div name="{{::options.year.name}}" data-year-select data-empty-option="{{::options.year.emptyOption}}" data-format="{{::options.year.format}}" data-last="{{::options.year.last}}"></div></div>',controller:this.controller,
link:m(this.link,this)}};p.prototype.controller=function(a){a.expiry=a.expiry||{};var b=a.getOptions()||{};angular.extend(a,{name:a.name||'expiry',getOptions:function(){b.month=b.month||{};b.year=b.year||{};var c=b.month.name||'month',d=b.year.name||'year',c=a.name+'['+c+']',d=a.name+'['+d+']';b.month.name=c;b.year.name=d;return b}});this.setMonth=function(c){a.expiry.month=c;return this};this.setYear=function(c){a.expiry.year=c;return this};this.q=function(a,b){return Date.now()>=new Date(b,a,0)}};
p.prototype.controller.$inject=['$scope'];p.prototype.link=function(a,b,c,d){var f=b.data('$expirySelectController');console.log(f,d);a.$on(a.options.month.name+'.selection',function(a,c){f.setMonth(c)});a.$on(a.options.year.name+'.selection',function(a,c){f.setYear(c)});d&&a.$watchCollection('[expiry.month, expiry.year]',function(a){var c=a[0];a=a[1];d.$setValidity('expiry',c&&a?!f.q(c.value,a.value):!1)})};p.prototype.link.$inject=['$scope','$element','$attrs','ngModelController'];var q=['MMMM','MMM','MM','M'],r=q[2];function t(){}t.prototype.a=function(){return{restrict:'AC',transclude:!0,replace:!1,template:'<div ng-transclude></div>',controller:this.controller}};t.prototype.controller=function(a,b){a.options=a.$eval(b.options);this.e=[];this.addSelect=function(a){var b=this;this.e.push(a);a.$on('$destroy',function(){b.removeSelect(a)})};this.removeSelect=function(a){a=this.e.indexOf(a);-1!==a&&this.e.splice(a,1)}};t.prototype.controller.$inject=['$scope','$attrs'];function u(a,b){var c=this,d=b.injector().get('filterFilter');this.s=function(){a.element=a.element||{};a.element.opts=[];for(var b=c.h(),d=c.i();b<=d;b++)a.element.opts.push({index:b,label:c.b(b),value:c.c(b)})};this.r=function(a){return angular.isDefined(a)&&a.index>=this.h()&&a.index<=this.i()&&a.value===this.c(a.index)&&a.label===this.b(a.index)};this.j=function(b,c){var h={};h[b]=c;return d(a.element.opts,h,!0)};this.h=function(){return+a.first};this.i=function(){return+a.last}}
u.$inject=['$scope','$element','$attrs'];function v(){var a='',b='',c='';this.g=function(){return b};this.p=function(){return c};this.o=function(){return a};this.l=function(a){if(/[^a-zA-Z]/.test(a))throw new TypeError('alpha string required; received "'+typeof a+'"');b=a;c=b.match(/([A-Z]?[^A-Z]*)/g).shift();return this};this.k=function(b){if(!angular.isString(b))throw new TypeError('string required; received "'+typeof b+'"');a=b;return this}}
v.prototype.a=function(){return{restrict:'AC',replace:!0,require:[this.g(),'ngModel','?^^selectComposite'],scope:{emptyOption:'@',format:'@',first:'@',last:'@'},controller:this.o(),compile:m(this.f,this),template:'<select data-ng-model="model" data-ng-options="opt as opt.label for opt in element.opts track by opt.value" ><option value="" data-ng-show="emptyOption !== \'\' && emptyOption !== undefined" data-ng-disabled="true">{{::emptyOption}}</option></select>'}};
v.prototype.f=function(a){a.attr('data-name')&&(a.attr('name',a.attr('data-name')),a.removeAttr('data-name'));return{pre:m(this.pre,this),post:m(this.post,this)}};v.prototype.f.$inject=['tElement','tAttrs'];v.prototype.pre=function(a,b,c){b.attr('name',c.name);this.d(a,b,c)};v.prototype.pre.$inject=['scope','iElem','iAttrs'];v.prototype.d=function(){};
v.prototype.post=function(a,b,c,d){if(!(2>d.length)){var f=d[0],g=d[1];b=d[2];d=this.g();var h=this.p(),k=function(b){g.$selection=b;g.$name&&a.$emit(g.$name+'.selection',b)},x=function(a){var b=f.r(a);g.$setValidity(h,b);if(b)return k(a),a;k(null)};b&&b.addSelect(a);f.s();c.$observe(d,function(b){b=f.j('label',b);1===b.length&&(a.model=b[0])});c.$observe('value',function(b){b=f.j('value',b);1===b.length&&angular.isUndefined(a.model)&&(a.model=b[0])});g.$parsers.unshift(x);g.$formatters.unshift(x)}};
v.prototype.post.$inject=['$scope','$element','$attrs','controllers'];function w(a,b){var c=b.injector().get('dateFilter');this.m=function(b){return c((new Date).setMonth(b),a.format)};u.call(this,a,b)}n(w,u);w.$inject=['$scope','$element','$attrs'];w.prototype.c=function(a){return(a+1).toString()};w.prototype.b=function(a){return this.m(a)};function y(){v.call(this)}n(y,v);y.prototype.d=function(a,b,c){c.$set('first','0');c.$set('last','11');1!==b.injector().get('filterFilter')(q,c.format,!0).length&&c.$set('format',r)};var z=['yyyy','yy','y'],A=z[0],B=''+(new Date).getFullYear();function C(a,b){var c=b.injector().get('dateFilter');this.n=function(b){return c(new Date(b.toString()),a.format)};u.call(this,a,b)}n(C,u);C.$inject=['$scope','$element','$attrs'];C.prototype.c=function(a){return a.toString()};C.prototype.b=function(a){return this.n(a)};function D(){v.call(this)}n(D,v);D.prototype.d=function(a,b,c){var d=b.injector().get('filterFilter');/^\d{4}$/.test(c.first)?a=c.first:(a=B,c.$set('first',a));a=+a;/^\d{4}$/.test(c.last)?b=c.last:(b=''+(a+10),c.$set('last',b));b=+b;if(a>b)throw Error('Last year must be greather than the first year (i.e., '+a+'); received: '+b);1!==d(z,c.format,!0).length&&c.$set('format',A)};angular.module('leodido.dateElements',[]).directive('expirySelect',function(){return(new p).a()}).directive('selectComposite',function(){return(new t).a()}).controller('MonthSelectController',w).directive('monthSelect',function(){return(new y).l('monthSelect').k('MonthSelectController').a()}).controller('YearSelectController',C).directive('yearSelect',function(){return(new D).l('yearSelect').k('YearSelectController').a()});})();
